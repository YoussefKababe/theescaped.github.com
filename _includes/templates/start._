<div class='start dialog clearfix'>
  <% if (!authenticated) { %>
    <div class="splash">
      <h2>Prose</h2>

      <div class="authorize">
        <p>Prose is a content editor for GitHub, optimized for managing websites.</p>
        <p><a href="/about.html">Learn more.</a></p>
        <a class="button" href="https://github.com/login/oauth/authorize?client_id={{site.oauth_client_id}}&scope=repo, user">Authorize with GitHub</a>
      </div>
    </div>
  <% } %>
</div>

<% if (authenticated) { %>
  <% if (organizations.length) { %>
    <h1>Organizations</h2>
    <div class="organizations">
    <% _.each(organizations, function(org) { %>
      <a class="organization" href="#<%= org.login %>" title="<%= org.login %>"><img src="<%= org.avatar_url %>" width="80" height="80"/></a>
    <% }); %>
    </div>
  <% } %>

  <h1>Repositories</h2>
  <% _.each(owners, function(repos, owner) { %>
    <% if (Object.keys(owners).length > 1) { %>
      <div class="owner"><a href="#<%= owner %>"><%= owner %></a>
        <div class="repo-count">
          <%= repos.length %> <%= repos.length > 1 ? "Repositories" : "Repository"%>
        </div>
      </div>
    <% } %>
    <div class="repos">
        <% _.each(repos, function(r, index) { %>
          <a title='edit' class="select-repo repo" data-user="<%= r.owner.login %>" data-repo="<%= r.name %>" href='#'>
            <div class="name"><%= r.name %></div>
            <div class="branches hidden"></div>
          </a>
        <% }); %>
    </div>
  <% }); %>
<% } %>

<div class='inner'>
  <div class='post-listing prose clearfix'>

  <% _.each(paths, function(p, index) { %>
    <% if (p.path !== current_path.path) { %>
      <a class='link folder' href='#<%= user %>/<%= repo %>/tree/<%= branch %><%= p.path ? "/" +p.path : "" %>'>
        <div class="filename"><%= p.path === _.parentPath(current_path.path) ? ".." : _.topPath(p.path) %></div>
      </a>
    <% } %>
  <% }); %>

  <% if (window.authenticated) { %>
    <a class='link new new-post' href='#<%= user %>/<%= repo %>/new/<%= branch %><%= path ? "/"+path : ""%>'>
      <div class="new-post button">New Post</div>
    </a>
  <% } %>

  <% if (posts.length > 0) { %>
    <% _.each(posts, function(post) { %>
      <!-- TODO: don't edit binary files -->
      <a class='link load-post toggle-view' href='#<%= user %>/<%= repo %>/edit/<%= branch %>/<%= post.path %>'>
        <div class="filename"><%= post.title || 'Untitled' %></div>
      </a>
    <% }); %>
    </div>
  <% } %>
</div>